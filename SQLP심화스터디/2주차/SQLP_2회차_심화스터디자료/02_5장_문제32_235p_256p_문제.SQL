/*
   아래 SQL을 튜닝하되, 원하는 방식으로 실행되도록(=절대 다른 방식으로 실행되지 못하도록) 힌트를 
   정확히 기술하고, 필요시 인덱스 구성 방안도 제시하시오.
*/

[데이터]
고객 : 100만 건
거래 : 1,0000 만건

[인덱스 구성]
고객_PK : 고객번호
거래_PK : 고객번호 + 거래일시

select count(*)
from   고객27 c
where  c.가입일시 < trunc(add_months(sysdate,-1))
and    not exists (
         select /*+ full(거래27) */
                'x'
		 from   거래27
		 where 고객번호 = c.고객번호
		 and    rownum <= 1
       )
;

--------------------------------------------------------------------------------------
| Id  | Operation              | Name       | Starts | A-Rows |   A-Time   | Buffers |
--------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT       |            |      1 |      1 |00:00:02.95 |    3004K|
|   1 |  SORT AGGREGATE        |            |      1 |      1 |00:00:02.95 |    3004K|
|*  2 |   FILTER               |            |      1 |     63 |00:00:02.95 |    3004K|
|*  3 |    TABLE FULL SCAN     | 고객27     |      1 |   1000K|00:00:00.11 |    4074 |
|*  4 |    COUNT STOPKEY       |            |   1000K|    999K|00:00:02.41 |    3000K|
|*  5 |     INDEX RANGE SCAN   | 거래_PK    |   1000K|    999K|00:00:02.19 |    3000K|
--------------------------------------------------------------------------------------