오라클은 UNDO 데이터를 이용해 읽기 일관성을 구현한다.

즉, undo에 저장된 정보를 이용해 쿼리가 시작된 시점을 기준으로 일관성 있는 결과집합을 생성해 낸다.

오라클은 데이터를 읽을 때 lock을 사용하지 않아 동시성 측면에서는 다른 DBMS 보다 우월하다.

하지만 오라클도 Lock으로 부터 자유롭지 못하다.

오라클에서 발생하는 lock 경합의 대부분은 enq:TM-contention event 와 enq:TX-row lock contention evetn 이다.

이들은 Application Event로 분류되어 있는데 같이 Application 으로 분리된 대기 이벤트 중 Sql\*Net break/rest to client 가 있다.

이 이벤트는 사용자가 수행한 sql문이, 존재하지 않는 테이블을 참조하거나 사용자 정의 함수 프로시저에서 처리하지 않은 예외사항을 만났을 때 나타난다.

테이블 lock과 로우 lock 관련 이벤트를 이런 유형의 프로그램 오류와 같이 분류한 것은 이들 문제가 DBA가 아닌 개발자 이슈이기 때문이다.

lock이 해제되지 않는 상황이 지속될 때 DBA가 할 수 있는 일은, LOCK을 소유한 세션을 찾아 프로세스를 강제로 중지시키는 것뿐이다.

근본적인 해법은 application logic에 있다.

lock은 각 데이터베이스의 특징을 결정짓는 핵심적인 원리이다.

따라소 Lock 메커니즘을 이애해야 고품질 애플리케이션을 구축할 수 있다.

트랜잭션과 동시성 제어에 대한 개념 또한 필수다.

## 트랜잭션 동시성 제어

### 동시성 제어

시스템 운영 시 데이터 구조가 점점 복잡해지고 데이터 정합성도 흐트러져 새로운 업무요건에 대응할 수 없는 상황에 직면하게 된다.

다중 사용자 환경에서 발생할 수 있는 갖가지 동시성 문제에 대한 충본한 고려 없이 개발된 시스템이기 때문이다.

고객이 직접 자신의 주문을 처리하는 환경에서는 미처 생각지 못한 일들이 훨씬 자주 발생한다.

더불어 동시 접속자 수도 비교할 수 없을 정도로 많아졌기 때문에 동시성 이슈는 훨씩 중요해졌다.

동시성 제어란, 동시에 실행되는 트랜잭션 수를 최대화하면서도 입력, 삭제, 검색 시 데이터의 무결성이 유지될 수 있도록 노력하는 것을 말한다.

여러 개의 트랜잭션이 동시에 수행될 때, 데이터베이스 에플리케이션은 트랜잭션이 서로 간섭하는 현상을 최소화하면서 데이터 일관성과 무결성이 보장되도록

개발되어야한다.

\- 동시성 : 다중 사용자가 같은 데이터를 동시에 액세스
\- 일관성 : 자신이 발생시킨 변경 사항과 다른 트랜잭션의 변경 사항을 포함해 일관성 있는 상태로 데이터 제공

동시성 제어가 어려운 이유는 동시성과 일관성이 트레이드 오프 관계에 있기 때문이다.

동시성을 높이려고 lock의 사용을 최소화하면 읽기 일관성을 유지하기 어렵고, 데이터 일관성을 높이려고 lock을 많이 사용하면 동시성이 떨어진다.

### 트랜잭션이란?

일관성 있게 데이터가 처리되려면 두 개 이상의 갱신연산이 동시에 실행될 수 있어야한다. 불행히도 이는 불가능하다.

따라서 트랜잭션 관리능력을 갖춘 DBMS는 차선책으로 동시 실행을 구현한다. 여러 개의 수정작업이 하나의 작업처럼 전부 처리되거나 아예 전부 처리되지 않 도록 하는데, 이런 일의 최소
단위를 트랜잭션이라고 한다.

은행 업무의 계좌이체 트랜잭션은 하나의 예금 계좌에서 인출하여 다른 예금 계좌로 입급하는데 이 두 작업은 하나의 단위로 함께 수행되야한다.

트랜잭션은 업무 처리의 기본 단위이므로 실제 앱 설계단계에서는 업무적인 관점에서 포관적으로 정의된다.

예를들어 계좌이체라는 트랜잭션을 정의할 때는 현금잔고를 확인하고 이체비밀번호/보안카드를 입력 받아 최종 이체가 완료되는 순간까지를 포함해 넓게 정의할 수 있다.

### 트랜잭션의 특징

\- 원자성 : 더 이상 분해가 불가능한 업무의 최소단위를 말한다.
\- 일관성 : 트랜잭션 실행의 결과로 데이터베이스 상태가 모순되지 않는다.
\- 격리성 : 트랜잭션 실행 중에 생성하는 연산의 중간 결과에다른 트랜잭션이 접근할 수 없다.
\- 영속성 : 트랜잭션이 실행을 성공적으로 완료하면 그 결과는 데이트베이스에 영속적으로 저장된다.

트랜잭션의 처리결과가 데이터의 일관성을 해치지 않도록 하려면 트랜잭션의 순차적 진행을 보장할 수 있는 직렬화 장치가 필요하다.

이를 위해 dbms가 공통적으로 사용하는 메커니즘이 lock이다.

뿐만 아니라 오라클은 더 높은 수준의 읽기 일관성을 보장하기 위해 undo 데이터를 활용한 독특한 읽기 일관성 모델을 사용한다.
