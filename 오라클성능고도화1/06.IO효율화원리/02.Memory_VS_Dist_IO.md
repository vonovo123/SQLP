### I/O 효율화 튜닝의 중요성

디스크를 경유한 입출력은 물리적 입출력 과정이 동반되기 때문에 느리다.

메모리를 통한 입출력은 전기적 식호를 이용해 입출력하기 땜누에 빠르다.

그래서 모든 DMBS는 데이터 입출력 시 버퍼 캐시를 경유한다.

읽고자 하는 블록을 먼저 버퍼 캐시에서 찾아보고, 찾지 못할 때만 디스크에서 읽는다.

메모리로부터 블록이 찾아지면 디스크상의 데이터 파일에서 읽는 것 보다 평균적으로 만배이상 빠르다.

물리적인 디스크 I/O가 필요햘 때면 서버 프로세스는 I/O 서브시스템에 I/O CAll을 발생시키고 잠시 대기하게 되므로 비용이 크다.

모든 데이터와 인덱스 블록을 DB 버퍼 캐시에 올려놓고 쓰기에는 비용과 기술적 한계가 있다.

메모리 가격이 저렴해지는 것 이상으로 데이터 증가 속도가 빠르기 때문이다.

메모리 자원을 효율적으로 사용해야하므로 자주 액세스하는 블록들이 캐시에 오래 남도록 LRU 알고리즘을 사용한다.

결국 디스크 I/O를 최소화하고, 대부분 처리를 메모리에서 할 수 있도록 버퍼 캐시 효율성을 높이는 것이 데이터베이스 성능을 좌우한다.

### 버퍼 캐시 히트율

전체 읽은 블록 중에서 얼마만큼을 메모리 버퍼 캐시에서 찾았는지를 나타내는 지표이다.

논리적 블록읽기는 메모리 I/O와 디스크 I/O를 모두 포함하므로 캐시에서 바로 찾은 블록의 수는 논리적 블록읽기 수 - 물리적 블록읽기 수 이다.

DIRECT PATH READ 방식으로 읽는 경우를 제외하면 모든 블록 읽기는 버퍼 캐시를 통해 이루어진다.

버퍼에서 찾지못한 블록을 읽어올때도 버퍼에 쓰고 읽는 과정을 거친다.

따라서 SQL을 수행하는 동안 캐시에서 읽은 총 블록의 수를 'Logical Reads' 라고 한다.

캐시에서 찾지못해 디스크에서 읽어온 블록의 수를 'Physical Reads' 라고 한다.

캐시에서 곧바로 찾은 블록 수는 디스크를 경유하지 않고 버퍼 캐시에서 찾은 블록 수를 말하므로 Logical Read 에서 Physical Read를 뺀 값이 버퍼 캐시에서 찾은 블록 수 입니다.

온라인 트랜잭션을 주로 처리하는 시스템이라면 BCHRd 99%를 목표로 해야한다. 개별 sql 측면에서 이 비율이 낮은 쿼리는 전체 성늘을 떨어뜨리는 원인이다.

논리적 블록읽기는 Query와 Current 항목을 더해서 구하며, Direct PAth Read 방식으로 읽은 블록이 없다면 이 두 값을 더한 것이 '총 읽은 블록 수'가 된다.

DIST는 물리적 블록 읽기 의수로 디스크에서 버퍼 캐시로 적재한 후 읽어온 블록의 수를 뜻한다.

다른 대기 이벤트가 없다면 CPU TIME, Elapsed time 간에 발생한 시간차는 대부분 디스크 I/O에서 발생한다.

BCHR을 구하는 공식에서 알 수 있는 것처럼 논맂거 블록읽기는 메모리리드로 이해하기 보다는 총 읽은 블록 수로 이해하는 것이 정확하다.

모든 블록을 메모리를 경유해 읽기때문에 결과적으로 같은 것이지만 논리적을 메모리로부터로 해석해 Call 통계를 잘못해석할 수 있기 때문이다.

논리적 블록 요청 횟수를 줄이고, 이를 통해 물리적 티스크에서 읽어야할 블록 수 자체를 줄이는 것이 I/o 효율화 튜닝의 핵심이다.

같은 블록을 반복적으로 액세스하는 형태의 애플리케이션이라면 논리적 I/O 요청이 비효율적으로 많이 발생하는데 BCHR은 매우 높게 나타난다.

작은 테이블을 자주 액세스하면 모든 블록이 메모리로 올라가므로 BCHR은 높지만 블록을 찾는 과저에서 래치획득이 수반되므로 비용이 크다.

같은 블록을 여러 세션이 동시에 액세스함으로 인해 래치 경합과 버퍼 Lock 경합까지 발생한다면 메모리 I/O 비용이 오히려 디스크 I/O 이상으로 커질 수 있다.

따라서 논리적으로 읽어야 할 블록의 수의 절대량이 많다면 반드시 SQL 튜닝을 실시해서 논리적인 블록 읽기를 최소화해야한다.

### 네트워크,파일시스템 캐시가 I/O 효율에 미치는 영향

최근에는 데이터베이스 서버와 스토리지 간에 NAS 서버나 SAN을 통해 연결되는 아키텍처를 사용한다. 대용량 데이터 저장과 관리기법에

이런 네트워크 기술이 사용됨에따라 튜닝시 네트워크 속도도 고려해야한다.

I/O 성능 개손 또한 네트워크를 통한 전송량을 최소화하려는 쪽에 기술이 모아지고 있따.

우선 서버와 스토리지 간에 더 크고 많은 파이프를 연결하려고 시도한다.

필요한 컬럼만 네트워크를 통해 전송하는 기술을 통해 스토리지에서 데비서버로 보내지는 데이터양을 획기적으로 줄이고 서버부하를 감소시킨다.

오라클 RAC에서는 인스턴스끼리 네트워크를 통해 캐시된 블록들을 서로 공유하므로 메모리 I/O 성능에도 네트워크 속도가 영향을 미친다.

기가바이트의 초고속 네트워크를 사용하더라도 로컬 캐시를 읽는것보다 빠를 수는 없다.

그렇다 보니 메모리에서 블록을 읽은 것으로나타나도 성능이 느린경우가있다.

이로인데 데이터베이스를 사용하는 데 있어 파일 시스템 버퍼 캐시는 최소화해야한다.

데이터베이스 자체적으로 캐시 영역을 갖고 있으므로 이를 위한 공간을 크게 할당해야한다

근본적인 해결책은 논리적 블록 요청횟수를 줄이는 것이다.
