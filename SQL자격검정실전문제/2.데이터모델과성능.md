31. 성능데이터모델링

- ~~성능이 저하된 결과를 대상으로 데이터모델보다는 문제발생 시점의 sql을 중심으로 튜닝한다.~~
- 데이터의 증가가 빠를 수록 성능저하에 따른 성능개선비용은 커진다.
- 데이터모델은 성능을 튜닝하면서 변경될 수 있다.
- 분석/설계 단계에서 성능을 고려한 모델링을 할 경우 성능 저하에 따른 rework 비용을 최소화 할 수 있다.

문제 발생 시점의 SQL을 중심으로 튜닝하는 것은 성능 데이터모델링과 무관한다.

32. 33. 성능 데이터 모델링 수행 절차

a. 정규화를 정확히 수행한다.
b. 데이터베이스 용량을 산정한다.
c. 데이터베이스에서 발생되는 트랜잭션 유형을 파악한다.
d. 용량과 트랜잭션의 유형에 따라 반정규화를 실시한다.
e. 이력모델 조정, pk/fk 조정,슈퍼타입, 서브타입 조정등을 수행한다.

34. 성능데이터모델링 시 고려해야할 사항

- ~~ 데이터모델링의 정규화는 항상 조회 성능저하를 유발하므로 반정규화 관점에서만 성능을 고려해 설계한다.~~
- 용량산정은 전체적인 데이터베이스에 발생되는 트랜잭션 유형과 양을 분석하는 자료가 되므로 성능데이터 모델링을 할 때 중요한 작업이된다.
- 물리적 데이터 모델링시 PK/FK의 컬럼의 순서조정, FK 인덱스 생성 등은 데이터 모델링 작업에 중요한 요소다.
- 이력데이터 처럼 대량으로 적재될 가능성이 높은 데이터는성능을 고려해 설계한다.

정규화는 기본적으로 중복된 데이터를 제거함으로써 조회성능을 향상시킬 수 있다.

35. 36. 2차 정규화

엔터티의 일반속성은 주식별자 전체에 종속되야한다.

함수 종속성 규칙에 따라 종속된 속성은 상위 속성 전체에 종속되야한다.

2차정규화를 통해 반정규화된 속성을 독립적인 엔터티로 분리하면 특정 조건에서 조회시 읽어야하는 레코드의 수가 반정규화된 테이블을 읽어올 때에비해 현저히 줄어든다.

37. 1차 정규화

동일한 유형의 속성이 칼럼단위로 반복되는 경우 속성의 원자성을 위배하여 1차 정규화의 대상이 된다.

반복적인 속성의 나열 형태에서는 각 속성에 대해 or 연산자로 조회할 수 밖에 없는데 이때 하나의 속성이라도 인덱스에 정이되있지않으면 성능 저하가 커진다.

인덱스에 포함되야할 속성이 많으면 CRUD 성능이 저하되기도한다.

38. 1차 정규화

동일한 유형의 속성이 칼럼 단위로 반복되는 경우 1차 정규화의 대상이 된다.

1차 정규화를 통해 1:M 관계의 두개의 엔터티로 분리할 수 있다.

39. 1차 정규형, 2차 정규화

PK에 대해 반복되는 그룹이 존재하지 않으면(동일한 유형의 속성이 칼럼 단위로 반복되는 경우가 아니므로) 1차 정규형이다.
부분 함수종속(엔터티의 일반속성이 주식별자 전체에 종속되지 않는 경우) 2차 정규화의 대상이 된다.

중복속성에 대한 분리가 1차 정규화의 대상이된다. 로우단위의 중복, 칼럼 단위의 중복 모두 해당된다.

40. 반정규화

반정규화는 정규화된 엔터티, 속성, 관계에 대해 시스템의 성능향상과 관리 단순화를 위해 중복, 통합, 분리 작업을 말한다.

고의적으로 데이터를 중복하여 성능을 향상시키지 위한 기법이다.

데이터의 무결설이 깨질 위험을 무릅쓰고 데이터를 중복하는 이유는 디스크 I/O가 많아 성능이 저하되거나 경로가 멀어 조인으로 인한 성능저하가 발생할 수 있기때문이다.

반정규화 정보에 대한 재현의 적시성으로 반정규화를 고려한다. 다수에 테이블에 대한 다량의 조인이 불가피할때, 데이터 제공의 적시성 확보를 위한 필수 반정규화 대상이 된다.

41. 반정규화

반정규화 기법은 테이블, 속성, 관계에 적용할 수 있다.

하나의 테이블의 전체 칼럼 중 자주 이용하는 집중화된 컬럼이 있을 때 디스크 I/O를 줄이기 위해 해당 칼럼들을 별도로 모으는 반 정규화 기법은 테이블추가 반정규화 기법 중에서

부분테이블 추가에 해당한다.

- 테이블의 반정규화

| 기법분류    | 반정규화 기법            |
| ----------- | ------------------------ |
| 테이블병합  | 1:1 관계 테이블병합      |
|             | 1:M 관계 테이블 병합     |
|             | 슈퍼/서브타입 테이블병합 |
| 테이블 분할 | 수직분할                 |
|             | 수평분할                 |
| 테이블추가  | 중복테이블추가           |
|             | 통계테이블 추가          |
|             | 이력테이블 추가          |
|             | 부분테이블 추가          |

- 컬럼의 반정규화

| 기법분류                          |
| --------------------------------- |
| 중복컬럼추가                      |
| 파생컬럼 추가                     |
| 이력테이블 칼럼추가               |
| PK에 의한 컬럼추가                |
| 응용시스템 오작동을 위한 컬럼추가 |

42. 반정규화 기법

조인 감소를 위해 여러 테이블에 동일한 컬럼을 갖도록 하는 기법은 컬럼의 반정규화 방법중 중복칼럼추가이다.

조회 성능 향상을 위해 미리 계산된 컬럼을 갖도록 하는 기법은 파생칼럼 추가기법이다.

최신값을 처리하는 이력의 특성을 고려해 기능성 컬럼을 추가하는 기법은 이력테이블 컬럼추가기법이다.

43. 반정규화 기법

전체를 통합한 계산된 파생컬럼을 특정엔터티에 추가하는 반정규화를 통해 성능을 향상시킬 수 있다.

44. 반정규화

데이터를 조회할 때 항상 최근에 변경된 값만 조회하는 경우 과도한 조인으로 인해 성능이 저하될 수 있다.

반정규화를 통해 최근 값을 부모 테이블에 갖고 있도록하면 성능 향상을 꽤할 수 있다.

자식 테이블에 가장 최근에 변경된 값임을 알 수 있도록 최신여부라는 속성을 추가해 조회 성능 저하를 예방할 수 있다.

조회 성능을 위해 한테이블로 통합하는 경우 자식 테이블에 있던 속성의 값이 변경될 경우 계속 발생하는 변경이력으로 용량이 과도하게 커지는 단점이 있다.
